<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lausete Äraarvamise Mäng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
        }

        .letter-box {
            width: 3.5rem;
            height: 4.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 900;
            border-bottom: 4px solid #334155;
            margin: 0.25rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .letter-box.filled {
            border: 2px solid #3b82f6;
            background: #1e293b;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .letter-box.revealed {
            background: #3b82f6;
            border-color: #60a5fa;
            color: white;
            transform: rotateY(360deg) scale(1.1);
        }

        .letter-box.word-win {
            background: #10b981 !important;
            border-color: #34d399 !important;
        }

        .win-animation {
            animation: bounce 0.5s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        #phraseContainer {
            perspective: 1000px;
        }

        /* Võidu overlay stiilid */
        #winOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 50;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="h-screen flex flex-col p-6 overflow-hidden">

    <!-- Võidu teavitusaken -->
    <div id="winOverlay" class="flex flex-col text-center">
        <h1 id="winStatus" class="text-7xl font-black text-emerald-400 mb-4 animate-bounce">SÕNA ÕIGE!</h1>
        <p id="winPhraseDisplay" class="text-3xl text-white mb-4 italic px-10"></p>
        <p id="winPointsDisplay" class="text-2xl text-emerald-300 mb-8 font-bold"></p>
        <div class="flex gap-4">
            <button id="overlayContinueBtn" onclick="hideWinOverlay()" class="bg-blue-500 hover:bg-blue-400 text-white font-black py-4 px-12 rounded-2xl text-2xl shadow-2xl transition-transform active:scale-95">JÄTKA SAMAGA</button>
            <button id="overlayNextBtn" onclick="newGame()" class="bg-emerald-500 hover:bg-emerald-400 text-emerald-950 font-black py-4 px-12 rounded-2xl text-2xl shadow-2xl transition-transform active:scale-95">JÄRGMINE LAUSE (Enter)</button>
        </div>
    </div>

    <!-- Päis: Punktid ja Info -->
    <div class="flex justify-between items-start mb-4">
        <!-- Tiim A -->
        <div id="teamAContainer" class="bg-blue-600 p-4 rounded-xl border-4 border-blue-400 text-center min-w-[160px] shadow-2xl transition-all duration-500">
            <h2 class="text-xl font-bold uppercase tracking-tight">Tiim A</h2>
            <div id="scoreA" class="text-5xl font-black">0</div>
            <div class="mt-2 flex justify-center gap-2">
                <button onclick="changeScore('A', -10)" class="bg-blue-800 hover:bg-blue-900 px-4 py-1 rounded shadow-inner">-10</button>
                <button onclick="changeScore('A', 10)" class="bg-blue-300 hover:bg-blue-200 text-blue-900 px-4 py-1 rounded font-bold shadow-md">+10</button>
            </div>
        </div>

        <!-- Kategooria ja Teavitused -->
        <div class="text-center flex-1 px-4 mt-6">
            <div id="categoryDisplay" class="text-2xl font-bold text-blue-400 uppercase tracking-[0.3em] mb-1">KATEGOORIA</div>
            <div id="turnInfo" class="text-emerald-400 font-bold uppercase tracking-widest animate-pulse">Tiim A kord</div>
        </div>

        <!-- Tiim B -->
        <div id="teamBContainer" class="bg-rose-600 p-4 rounded-xl border-4 border-rose-400 text-center min-w-[160px] shadow-2xl transition-all duration-500 opacity-50">
            <h2 class="text-xl font-bold uppercase tracking-tight">Tiim B</h2>
            <div id="scoreB" class="text-5xl font-black">0</div>
            <div class="mt-2 flex justify-center gap-2">
                <button onclick="changeScore('B', -10)" class="bg-rose-800 hover:bg-rose-900 px-4 py-1 rounded shadow-inner">-10</button>
                <button onclick="changeScore('B', 10)" class="bg-rose-300 hover:bg-rose-200 text-rose-900 px-4 py-1 rounded font-bold shadow-md">+10</button>
            </div>
        </div>
    </div>

    <!-- Mänguväli -->
    <div class="flex-grow flex items-center justify-center py-10">
        <div id="phraseContainer" class="flex flex-wrap justify-center items-center max-w-7xl gap-y-12"></div>
    </div>

    <!-- Pakutud tähed -->
    <div class="mb-6 text-center">
        <div class="text-xs uppercase tracking-[0.5em] text-slate-500 mb-3 font-bold">Pakutud tähed</div>
        <div id="usedLetters" class="text-3xl font-bold tracking-[0.4em] min-h-[3rem] flex justify-center items-center flex-wrap gap-2"></div>
    </div>

    <!-- Alumine paneel -->
    <div class="mt-auto flex justify-between items-center bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
        <div class="flex gap-4">
            <button id="newGameBtn" onclick="newGame()" class="bg-emerald-500 hover:bg-emerald-400 text-emerald-950 font-black py-3 px-10 rounded-xl text-xl shadow-lg transition-transform active:scale-95">UUS LAUSE</button>
            <button onclick="revealAll()" class="bg-slate-700 hover:bg-slate-600 text-slate-200 py-3 px-6 rounded-xl text-lg font-bold">NÄITA VASTUST</button>
        </div>
        
        <div class="flex gap-10 items-center">
            <div class="text-slate-400 text-sm font-medium leading-tight">
                <span class="text-blue-400 font-bold">TÄHED:</span> Paku tähte<br>
                <span class="text-blue-400 font-bold">TAB:</span> Vaheta tiimi
            </div>
            <div class="text-slate-400 text-sm font-medium leading-tight text-right">
                <span class="text-blue-400 font-bold">ENTER:</span> Järgmine lause<br>
                <span class="text-blue-400 font-bold">SPACE:</span> Fookus uuele nupule
            </div>
        </div>
    </div>

    <script>
        const gameData = [
            { phrase: "Aeg parandab haavad aga jätab armid", category: "Vanasõna" },
            { phrase: "Ahnus ajab auku", category: "Vanasõna" },
            { phrase: "Ametil on kuldpõhi all", category: "Vanasõna" },
            { phrase: "Ega magajale kassile hiir suhu jookse", category: "Vanasõna" },
            { phrase: "Enne mõtle pärast ütle", category: "Vanasõna" },
            { phrase: "Esimene vasikas läheb ikka aia taha", category: "Vanasõna" },
            { phrase: "Hulk kokki teeb lahja leeme", category: "Vanasõna" },
            { phrase: "Hundid söönud lambad terved", category: "Vanasõna" },
            { phrase: "Häda ajab härja kaevu", category: "Vanasõna" },
            { phrase: "Iga algus on raske", category: "Vanasõna" },
            { phrase: "Kus viga näed laita seal tule ja aita", category: "Vanasõna" },
            { phrase: "Käbi ei kuku kännust kaugele", category: "Vanasõna" },
            { phrase: "Töö kardab meistrit", category: "Vanasõna" },
            { phrase: "Töö kiidab tegijat", category: "Vanasõna" },
            { phrase: "Uus luud pühib toa puhtaks", category: "Vanasõna" },
            { phrase: "Vaga vesi sügav põhi", category: "Vanasõna" },
            { phrase: "Veerevale kivile ei kasva sammalt", category: "Vanasõna" },
            { phrase: "Hooletus ees õnnetus taga", category: "Vanasõna" },
            { phrase: "Parem varblane peos kui tuvi katusel", category: "Vanasõna" },
            { phrase: "Mida Juku ei õpi seda Juhan ei tea", category: "Vanasõna" }
        ];

        let availablePhrases = [...gameData];
        let currentPhrase = "";
        let guessedLetters = new Set();
        let completedWordIndexes = new Set();
        let scoreA = 0;
        let scoreB = 0;
        let activeTeam = 'A';
        let isGameWon = false;

        // Heliefektide süsteem
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(freq, type, duration, vol = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        const sounds = {
            correct: () => playSound(880, 'sine', 0.2),
            wrong: () => playSound(220, 'sawtooth', 0.3, 0.05),
            wordWin: () => {
                const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                notes.forEach((f, i) => setTimeout(() => playSound(f, 'sine', 0.3, 0.05), i * 100));
            },
            win: () => {
                const notes = [440, 554, 659, 880];
                notes.forEach((f, i) => setTimeout(() => playSound(f, 'square', 0.5, 0.05), i * 150));
            },
            new: () => playSound(660, 'sine', 0.15)
        };

        function updateScoreDisplays() {
            document.getElementById('scoreA').innerText = scoreA;
            document.getElementById('scoreB').innerText = scoreB;
        }

        function changeScore(team, amount) {
            if (team === 'A') scoreA = Math.max(0, scoreA + amount);
            else scoreB = Math.max(0, scoreB + amount);
            updateScoreDisplays();
        }

        function switchTeam() {
            activeTeam = activeTeam === 'A' ? 'B' : 'A';
            document.getElementById('teamAContainer').classList.toggle('opacity-50', activeTeam !== 'A');
            document.getElementById('teamBContainer').classList.toggle('opacity-50', activeTeam !== 'B');
            
            const turnInfo = document.getElementById('turnInfo');
            turnInfo.innerText = `Tiim ${activeTeam} kord`;
            turnInfo.className = activeTeam === 'A' ? 'text-blue-400 font-bold uppercase tracking-widest animate-pulse' : 'text-rose-400 font-bold uppercase tracking-widest animate-pulse';
        }

        function newGame() {
            if (availablePhrases.length === 0) {
                availablePhrases = [...gameData];
            }

            const randomIndex = Math.floor(Math.random() * availablePhrases.length);
            const data = availablePhrases.splice(randomIndex, 1)[0];
            
            currentPhrase = data.phrase.toUpperCase();
            guessedLetters.clear();
            completedWordIndexes.clear();
            isGameWon = false;
            
            document.getElementById('categoryDisplay').innerText = data.category;
            document.getElementById('usedLetters').innerHTML = "";
            document.getElementById('winOverlay').style.display = 'none';
            
            sounds.new();
            renderPhrase();
        }

        function renderPhrase() {
            const container = document.getElementById('phraseContainer');
            container.innerHTML = "";
            
            const words = currentPhrase.split(" ");
            let newlyCompletedWord = null;
            let allPhraseComplete = true;

            words.forEach((word, wordIdx) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = "flex mx-4 mb-2 word-group";
                wordDiv.dataset.index = wordIdx;
                
                let isWordComplete = true;
                [...word].forEach(char => {
                    const isLetter = /[A-ZÕÄÖÜ]/.test(char);
                    if (isLetter && !guessedLetters.has(char)) {
                        isWordComplete = false;
                        allPhraseComplete = false;
                    }
                });

                // Kui sõna sai just valmis
                if (isWordComplete && !completedWordIndexes.has(wordIdx)) {
                    newlyCompletedWord = word;
                    completedWordIndexes.add(wordIdx);
                }

                [...word].forEach(char => {
                    const box = document.createElement('div');
                    const isLetter = /[A-ZÕÄÖÜ]/.test(char);
                    
                    if (isLetter) {
                        box.className = "letter-box filled";
                        if (guessedLetters.has(char)) {
                            box.innerText = char;
                            box.classList.add('revealed');
                            if (isWordComplete) box.classList.add('word-win');
                        }
                    } else {
                        box.className = "letter-box revealed"; 
                        box.innerText = char;
                        box.style.borderBottom = "none";
                        box.style.background = "transparent";
                    }
                    wordDiv.appendChild(box);
                });
                
                container.appendChild(wordDiv);
            });

            if (newlyCompletedWord && !allPhraseComplete) {
                handleWordWin(newlyCompletedWord, false);
            } else if (allPhraseComplete && !isGameWon && currentPhrase.length > 0) {
                handleWordWin(words[words.length-1], true);
            }
        }

        function handleGuess(letter) {
            if (!currentPhrase || guessedLetters.has(letter) || isGameWon) return;
            
            guessedLetters.add(letter);
            
            const usedEl = document.getElementById('usedLetters');
            const span = document.createElement('span');
            span.innerText = letter;
            
            const letterCount = currentPhrase.split(letter).length - 1;

            if (letterCount > 0) {
                const pointsToAdd = letterCount * 10;
                if (activeTeam === 'A') scoreA += pointsToAdd;
                else scoreB += pointsToAdd;
                
                span.className = "text-blue-400 px-2 animate-bounce";
                sounds.correct();
                updateScoreDisplays();
            } else {
                span.className = "text-slate-600 px-2";
                sounds.wrong();
                switchTeam();
            }
            
            usedEl.appendChild(span);
            renderPhrase();
        }

        function handleWordWin(word, isLastWord) {
            if (isLastWord) {
                isGameWon = true;
                sounds.win();
                document.getElementById('winStatus').innerText = "LAUSE VALMIS!";
                document.getElementById('winStatus').className = "text-7xl font-black text-emerald-400 mb-4 animate-bounce";
                document.getElementById('overlayContinueBtn').style.display = "none";
                document.getElementById('overlayNextBtn').innerText = "JÄRGMINE LAUSE (Enter)";
                
                // Võiduefekt kõigile
                document.querySelectorAll('.letter-box.revealed').forEach((el, i) => {
                    setTimeout(() => el.classList.add('win-animation'), i * 30);
                });
            } else {
                sounds.wordWin();
                document.getElementById('winStatus').innerText = "SÕNA ÕIGE!";
                document.getElementById('winStatus').className = "text-7xl font-black text-blue-400 mb-4 animate-bounce";
                document.getElementById('overlayContinueBtn').style.display = "block";
                document.getElementById('overlayNextBtn').innerText = "UUS LAUSE";
            }

            setTimeout(() => {
                document.getElementById('winPhraseDisplay').innerText = isLastWord ? currentPhrase : `Sõna: ${word}`;
                document.getElementById('winPointsDisplay').innerText = `Tiim ${activeTeam} on tubli!`;
                document.getElementById('winOverlay').style.display = 'flex';
            }, 800);
        }

        function hideWinOverlay() {
            document.getElementById('winOverlay').style.display = 'none';
        }

        function revealAll() {
            [...currentPhrase].forEach(char => {
                if (/[A-ZÕÄÖÜ]/.test(char)) guessedLetters.add(char);
            });
            renderPhrase();
        }

        document.addEventListener('keydown', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const key = e.key.toUpperCase();
            
            if (key === 'ENTER') {
                if (document.getElementById('winOverlay').style.display === 'flex') {
                    if (isGameWon) newGame();
                    else hideWinOverlay();
                } else {
                    newGame();
                }
            } else if (key === 'TAB') {
                e.preventDefault();
                switchTeam();
            } else if (key === ' ') {
                document.getElementById('newGameBtn').focus();
            } else if (/^[A-ZÕÄÖÜ]$/.test(key)) {
                handleGuess(key);
            }
        });

        window.onload = newGame;
    </script>
</body>
</html>
